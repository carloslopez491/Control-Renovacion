<!DOCTYPE html>  
<html lang="es">  
<head>  
  <meta charset="UTF-8">  
  <title>Registro de Equipos - CredibanCo x Colsof</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1">  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>  
  <script src="https://unpkg.com/html5-qrcode"></script>  
  <style>  
  
  body {  
    font-family: 'Segoe UI', sans-serif;  
    background: linear-gradient(to right, #000000, #077359);  
    color: #fff;  
    padding: 10px;  
    margin: 0;  
    text-align: center;  
    animation: fadeIn 0.8s ease-in-out;  
  }  
  .container {
  max-width: 300px;
  margin: 80px auto;
  background: #fff;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}
  @keyframes fadeIn {  
    from { opacity: 0; transform: translateY(-10px); }  
    to { opacity: 1; transform: translateY(0); }  
  }  
  
  header {  
    display: flex;  
    align-items: center;  
    justify-content: center;  
    padding: 12px;  
    background: linear-gradient(to right, #000000, #077359);
    border-bottom: 4px solid var(--color-amarillo);  
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);  
    margin-bottom: 30px;  
  }  
  
  header img {  
    height: 50px;  
    margin: 0 20px;  
    background: white;
    padding: 9px;  
    border-radius: 9px;  
  }  
  
  input, button, select {  
    width: 90%;  
    max-width: 420px;  
    padding: 12px;  
    margin: 12px auto;  
    border-radius: 8px;  
    border: none;  
    font-size: 16px;  
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);  
    display: block;  
    transition: 0.3s ease;  
  }  
  
  input:focus, select:focus {  
    outline: none;  
    box-shadow: 0 0 8px var(--color-amarillo);  
  }  
  
  button {  
    background: linear-gradient(to right, #000000, #077359);
    color: #fff;  
    font-weight: bold;  
    transition: background 0.3s, transform 0.2s;  
    cursor: pointer;  
  }  
  
  button:hover {  
    background-color: #ffe066;  
    transform: scale(1.03);  
  }  
  
  h2, h3 {  
    color: #fff;  
    text-shadow: 1px 1px 3px rgba(0,0,0,0.2);  
  }  
  
  .registro {  
    background: #ffffff;  
    color: #000000;  
    border-radius: 14px;  
    padding: 20px;  
    margin: 20px auto;  
    max-width: 700px;  
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);  
    transition: transform 0.3s ease;  
    text-align: left;  
    border-left: 8px solid var(--color-amarillo);  
  }  
  
  .registro:hover {  
    transform: scale(1.01);  
  }  
  
  .registro p {  
    margin: 8px 0;  
    padding-bottom: 4px;  
    border-bottom: 1px solid #ddd;  
    font-size: 15px;  
  }  
  
  .registro label {  
    display: block;  
    margin-top: 12px;  
    font-weight: bold;  
    font-size: 14px;  
  }  
  
  .registro select {  
    width: 100%;  
    margin-top: 6px;  
    padding: 8px;  
    border-radius: 6px;  
    border: 1px solid #ccc;  
    font-size: 14px;  
    background: #f9f9f9;  
  }  
  
  .registro button {  
    background-color: var(--color-error);  
    color: white;  
    margin-top: 14px;  
    padding: 10px 20px;  
    border-radius: 6px;  
    font-weight: bold;  
    font-size: 14px;  
    transition: background 0.3s;  
  }  
  
  .registro button:hover {  
    background-color: #cc0000;  
  }  
  
  #exportButtons {  
    margin: 20px auto;  
  }  
  
  #reader {  
    width: 300px;  
    margin: 20px auto;  
    display: none;  
    border-radius: 10px;  
    overflow: hidden;  
    box-shadow: 0 0 10px #00000050;  
    background: white;  
  }  
  
  #scanButton {  
    color: white;  
    font-weight: bold;  
    margin-bottom: 15px;  
  }  
  
  #buscador {
  width: 90%;
  max-width: 420px;
  padding: 12px;
  margin: 12px auto;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  display: block;
}

#usuario {
  width: 90%;
  max-width: 420px;
  padding: 12px;
  margin: 12px auto;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  display: block;
}

#serial {
  width: 90%;
  max-width: 420px;
  padding: 12px;
  margin: 12px auto;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  display: block;
}

#nombre {
  width: 90%;
  max-width: 420px;
  padding: 12px;
  margin: 12px auto;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  display: block;
}

  
  /* Alerta de √©xito y eliminaci√≥n */  
  .alerta {  
    position: fixed;  
    bottom: 30px;  
    left: 50%;  
    transform: translateX(-50%);  
    background-color: var(--color-exito);  
    color: white;  
    padding: 14px 24px;  
    border-radius: 8px;  
    font-weight: bold;  
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);  
    opacity: 0;  
    visibility: hidden;  
    transition: opacity 0.4s, visibility 0.4s, transform 0.4s;  
    z-index: 9999;  
  }  
  
  .alerta.mostrar {  
    opacity: 1;  
    visibility: visible;  
    transform: translateX(-50%) translateY(-10px);  
  }  
  
  .alerta.error {  
    background-color: var(--color-error);  
  }  
</style>  
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #000000, #077359);
    margin: 0;
    padding: 0;
    
  }

  .container {
    padding: 20px;
    max-width: 500px;
    margin: auto;
  }

  h2 {
    color: #000;
    margin-bottom: 20px;
    text-align: center;
  }

  .form-group {
    margin-bottom: 15px;
  }

  label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }

  input, select {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  .btn {
    background-color: #0066cc;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
  }

  .btn:hover {
    background-color: #004c99;
  }

  .card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0px 2px 10px rgba(0,0,0,0.1);
  }

  .card p {
    margin: 5px 0;
  }

  .btn-danger {
    background-color: #cc0000;
    margin-top: 10px;
  }

  .btn-danger:hover {
    background-color: #990000;
  }
</style>
<style>
  .pdf-card {
    border: 1px solid #ccc;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    font-family: 'Arial', sans-serif;
  }

  .pdf-card h3 {
    color: #003366;
    margin-top: 0;
  }

  .pdf-card p {
    margin: 4px 0;
    font-size: 14px;
  }
</style>
</head>  
<div id="alerta" class="alerta"></div>  
<body>  
  <header style="display: flex; justify-content: center; align-items: center; padding: 12px; background: #fff; border-bottom: 4px solid var(--color-amarillo); position: relative;">
  <!-- Logos centrados -->
  <div style="display: flex; gap: 20px;">
    <img src="https://www.paymentmedia.com/gallery/67d3486027b08credibanco_logo.jpg" alt="CredibanCo">  
    <img src="data:image/png;base64,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" alt="Colsof">  
<button id="logoutButton" onclick="cerrarSesion()" style="
    position: absolute;
    right: 15px;
    top: 10px;
    background-color: #ffcc00;
    color: #002f6c;
    font-weight: bold;
    border: none;
    padding: 10px;
    width: 50px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  ">
  üîí
</button>
  </header>  
  
  <div class="container">
  <h2><i class="fas fa-laptop"></i> Registro de Equipos</h2>
  
  
  <button id="scanButton" onclick="iniciarEscaneo()"><i class="fas fa-qrcode"> Escanear QR</button>  
  <div id="reader"></div>  
  
  <input type="text" id="serial" placeholder="Serial" oninput="actualizarNombre()">  
  <select id="tipo" onchange="actualizarNombre()">  
    <option value="">Tipo</option>  
    <option value="X1">X1</option>  
    <option value="X13">X13</option>  
  </select>  
  <input type="text" id="nombre" placeholder="Nombre generado" readonly>  
  <select id="caja">  
  <option value="">Caja</option>  
  <input type="text" id="usuario" placeholder="Usuario">  
  <select id="agentes" multiple>  
    <option value="Wazuh">Wazuh</option>  
    <option value="Nessus">Nessus</option>  
    <option value="CA">CA</option>  
    <option value="Portal">Portal</option>  
    <option value="Wsus">Wsus</option>  
    <option value="Antivirus">Antivirus</option>  
  </select>  
  <select id="tecnico">  
    <option value="">T√©cnico</option>  
    <option value="Santiago">SANTIAGO</option>  
    <option value="Leonardo">LEONARDO</option>  
    <option value="Miguel">MIGUEL</option>  
    <option value="Sebastian">SEBASTIAN</option>  
    <option value="Ronald">RONALD</option>  
    <option value="Jefferson">JEFFERSON</option>  
    <option value="Mesa">MESA</option>  
  </select>  
  <select id="proceso">  
    <option value="">Proceso</option>  
    <option value="Agentes">Agentes</option>  
    <option value="Backup">Backup</option>  
    <option value="Perfilando Usuario">Perfilando Usuario</option>  
    <option value="Instalando Aplicativos">Instalando Aplicativos</option>  
    <option value="Pendiente Por Entregar">Pendiente Por Entregar</option>  
    <option value="Entregado">Entregado</option>  
  </select>  
  
  <button onclick="guardarDatos()"><i class="fas fa-save"></i> Guardar</button>  
  
  <h3 style="color: black;">Equipos Registrados</h3>  
  
  <div id="exportButtons">  
    <button onclick="exportarExcel()"><i class="fas fa-file-excel"> Exportar Excel</button>  
  </div>  
  
<input type="text" id="buscador" placeholder="üîç Buscar por Serial, Usuario o Caja" oninput="filtrarRegistros()">
  
  <div id="listaRegistros"></div>  
    
  <!-- Spinner flotante -->
<div class="spinner-overlay" id="spinner">
  <div class="spinner-box">
    <i class="fas fa-spinner"></i>
    <p>Guardando datos...</p>
  </div>
</div>
  
  <script type="module">  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";  
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";  
  
    const firebaseConfig = {  
      apiKey: "AIzaSyDAR-M6JCLFVboO_30PSM-8Izek_YAGewI",  
      authDomain: "control-renovacion.firebaseapp.com",  
      databaseURL: "https://control-renovacion-default-rtdb.firebaseio.com",  
      projectId: "control-renovacion",  
      storageBucket: "control-renovacion.firebasestorage.app",  
      messagingSenderId: "809606815686",  
      appId: "1:809606815686:web:ea348cf1e6607a16d75cc7",  
      measurementId: "G-9G2WVSK69K"  
    };  
  
    const app = initializeApp(firebaseConfig);  
    const db = getDatabase(app);  
  
    window.guardarDatos = function () {  
      const serial = document.getElementById('serial').value;  
      const tipo = document.getElementById('tipo').value;  
      const nombre = document.getElementById('nombre').value;  
      const usuario = document.getElementById('usuario').value;  
      const caja = document.getElementById('caja').value;  
      const agentes = Array.from(document.getElementById('agentes').selectedOptions).map(opt => opt.value);  
      const tecnico = document.getElementById('tecnico').value;  
      const proceso = document.getElementById('proceso').value;  
  
      if (!serial || !tipo || !usuario) return alert("Faltan campos requeridos");  
  
      push(ref(db, 'equipos'), { serial, tipo, nombre, usuario, agentes, tecnico, proceso, caja });  
      limpiarCampos();  
    }  
  
    function limpiarCampos() {  
      document.getElementById('serial').value = "";  
      document.getElementById('tipo').value = "";  
      document.getElementById('nombre').value = "";  
      document.getElementById('usuario').value = "";  
      document.getElementById('agentes').selectedIndex = -1;  
      document.getElementById('tecnico').value = "";  
      document.getElementById('proceso').value = "";  
    }  
  
    window.actualizarNombre = function () {  
      const serial = document.getElementById('serial').value;  
      const tipo = document.getElementById('tipo').value;  
      document.getElementById('nombre').value = tipo && serial ? `BOG${tipo}${serial}` : '';  
    }  
  
    function mostrarRegistros() {    
  const contenedor = document.getElementById('listaRegistros');    
  onValue(ref(db, 'equipos'), snapshot => {    
    contenedor.innerHTML = "";    
    snapshot.forEach(child => {    
      const d = child.val(), id = child.key;    
      const div = document.createElement('div');    
  
      // ‚úÖ Clase y atributos para b√∫squeda (sin t√©cnico)
      div.className = 'registro item-registro';    
      div.dataset.serial = (d.serial || '').toLowerCase();    
      div.dataset.usuario = (d.usuario || '').toLowerCase();    
      div.dataset.nombre = (d.nombre || '').toLowerCase();    
      div.dataset.caja = (d.caja || '').toLowerCase();    
      div.dataset.agentes = Array.isArray(d.agentes) ? d.agentes.join(', ').toLowerCase() : (d.agentes || '').toLowerCase();  
  
      div.innerHTML = `    
        <p><strong>Serial:</strong> ${d.serial}</p>    
        <p><strong>Nombre:</strong> ${d.nombre}</p>    
        <p><strong>Tipo:</strong> ${d.tipo}</p>    
        <p><strong>Caja:</strong> ${d.caja || ''}</p>    
        <p><strong>Usuario:</strong> ${d.usuario}</p>    
        <p><strong>Agentes:</strong> ${Array.isArray(d.agentes) ? d.agentes.join(", ") : d.agentes || ''}</p>    
        <label>Tecnico:    
          <select onchange="editarCampo('${id}', 'tecnico', this.value)">    
            <option value="Santiago" ${d.tecnico==='Santiago'?'selected':''}>Santiago</option>    
            <option value="Ronald" ${d.tecnico==='Ronald'?'selected':''}>Ronald</option>    
            <option value="Leonardo" ${d.tecnico==='Leonardo'?'selected':''}>Leonardo</option>    
            <option value="Mesa" ${d.tecnico==='Mesa'?'selected':''}>Mesa</option>    
            <option value="Miguel" ${d.tecnico==='Miguel'?'selected':''}>Miguel</option>    
            <option value="Jefferson" ${d.tecnico==='Jefferson'?'selected':''}>Jefferson</option>    
            <option value="Sebasti√°n" ${d.tecnico==='Sebasti√°n'?'selected':''}>Sebasti√°n</option>    
            <option value="Mesa" ${d.tecnico==='Mesa'?'selected':''}>Sebasti√°n</option>    
          </select>    
        </label>    
        <label>Proceso:    
          <select onchange="editarCampo('${id}', 'proceso', this.value)">    
            <option value="Agentes" ${d.proceso==='Agentes'?'selected':''}>Agentes</option>    
            <option value="Backup" ${d.proceso==='Backup'?'selected':''}>Backup</option>    
            <option value="Perfilando Usuario" ${d.proceso==='Perfilando Usuario'?'selected':''}>Perfilando Usuario</option>    
            <option value="Instalando Aplicativos" ${d.proceso==='Instalando Aplicativos'?'selected':''}>Instalando Aplicativos</option>    
            <option value="Pendiente Por Entregar" ${d.proceso==='Pendiente Por Entregar'?'selected':''}>Pendiente Por Entregar</option>    
            <option value="Entregado" ${d.proceso==='Entregado'?'selected':''}>Entregado</option>    
          </select>    
        </label>    
        <button onclick="eliminarRegistro('${id}')">‚ùå Eliminar</button>    
      `;    
      contenedor.appendChild(div);    
    });    
  });    
}
  
    window.eliminarRegistro = id => remove(ref(db, `equipos/${id}`));  
    window.editarCampo = (id, campo, valor) => update(ref(db, `equipos/${id}`), { [campo]: valor });  
  
    
  
    window.exportarExcel = () => {  
      const data = [];  
      document.querySelectorAll('.registro').forEach(div => {  
        const datos = {};  
        div.querySelectorAll('p').forEach(p => {  
          const [key, value] = p.innerText.split(": ");  
          datos[key] = value;  
        });  
        data.push(datos);  
      });  
      const wb = XLSX.utils.book_new();  
      const ws = XLSX.utils.json_to_sheet(data);  
      XLSX.utils.book_append_sheet(wb, ws, "Equipos");  
      XLSX.writeFile(wb, "equipos.xlsx");  
    }  
  
    window.iniciarEscaneo = async () => {  
  const readerDiv = document.getElementById("reader");  
  readerDiv.style.display = "block";  
  
  const qr = new Html5Qrcode("reader");  
  const cameras = await Html5Qrcode.getCameras();  
  
  if (cameras && cameras.length > 0) {  
    // Intentar encontrar una c√°mara trasera  
    const backCamera = cameras.find(cam =>  
      cam.label.toLowerCase().includes("back") || cam.label.toLowerCase().includes("trasera")  
    );  
  
    const selectedCamera = backCamera || cameras[0]; // Si no encuentra, usa la primera  
  
    qr.start(  
      selectedCamera.id,  
      { fps: 10, qrbox: 250 },  
      (decodedText) => {  
        document.getElementById("serial").value = decodedText;  
        actualizarNombre();  
        qr.stop().then(() => {  
          readerDiv.innerHTML = "";  
          readerDiv.style.display = "none";  
        });  
      },  
      (error) => {  
        // Puedes mostrar el error si lo necesitas  
        console.warn(error);  
      }  
    );  
  } else {  
    alert("No se detectaron c√°maras.");  
  }  
};  

window.filtrarRegistros = function () {
  const filtro = document.getElementById('buscador').value.toLowerCase();
  document.querySelectorAll('.item-registro').forEach(div => {
    const serial = div.dataset.serial || '';
    const usuario = div.dataset.usuario || '';
    const caja = div.dataset.caja || '';

    if (serial.includes(filtro) || usuario.includes(filtro) || caja.includes(filtro)) {
      div.style.display = '';
    } else {
      div.style.display = 'none';
    }
  });
};



function cerrarSesion() {
  localStorage.removeItem("autenticado");
  location.reload();
}
  
// Generar opciones de 1 a 20000 para el selector de caja  
const cajaSelect = document.getElementById('caja');  
for (let i = 500; i <= 20000; i++) {  
  const option = document.createElement('option');  
  option.value = i;  
  option.textContent = i;  
  cajaSelect.appendChild(option);  
}  
  
    mostrarRegistros();  
  </script>  
  <script>
function cerrarSesion() {
  alert("Sesi√≥n cerrada");
  location.href = "index.html";
}
</script>
<script>
function mostrarSpinner() {
  const spinner = document.getElementById("spinner");
  spinner.style.display = "flex";
  
  setTimeout(() => {
    spinner.style.display = "none";
    alert("Datos guardados con √©xito");
  }, 2000); // Simula guardado
}
</script>
<script>
  // Leer datos de Firebase
  function cargarEquipos() {
    const equiposContainer = document.getElementById('equiposContainer');
    equiposContainer.innerHTML = ''; // Limpiar antes de cargar

    firebase.database().ref('equipos').once('value', function(snapshot) {
      snapshot.forEach(function(childSnapshot) {
        const data = childSnapshot.val();

        const equipoHTML = `
          <div class="equipo-card">
            <p><strong>SERIAL:</strong> ${data.serial}</p>
            <p><strong>NOMBRE:</strong> ${data.nombre}</p>
            <p><strong>TIPO:</strong> ${data.tipo}</p>
            <p><strong>CAJA:</strong> ${data.caja}</p>
            <p><strong>USUARIO:</strong> ${data.usuario}</p>
            <p><strong>AGENTES:</strong> ${data.agentes}</p>

            <label>T√âCNICO:</label>
            <select>
              <option ${data.tecnico === 'Ronald' ? 'selected' : ''}>Ronald</option>
              <option ${data.tecnico === 'Carlos' ? 'selected' : ''}>Carlos</option>
              <!-- Agrega m√°s t√©cnicos si es necesario -->
            </select>

            <label>PROCESO:</label>
            <select>
              <option ${data.proceso === 'Pendiente Por Entregar' ? 'selected' : ''}>Pendiente Por Entregar</option>
              <option ${data.proceso === 'Entregado' ? 'selected' : ''}>Entregado</option>
              <!-- Agrega m√°s estados si quieres -->
            </select>

            <button class="btn-rojo" onclick="eliminarEquipo('${childSnapshot.key}')">‚ùå Eliminar</button>
          </div>
        `;

        equiposContainer.innerHTML += equipoHTML;
      });
    });
  }

  function toggleEquipos() {
    const container = document.getElementById('equiposContainer');
    const isVisible = container.style.display === 'block';

    container.style.display = isVisible ? 'none' : 'block';

    if (!isVisible) {
      cargarEquipos();
    }
  }

  function eliminarEquipo(id) {
    if (confirm('¬øEst√°s seguro de eliminar este equipo?')) {
      firebase.database().ref('equipos/' + id).remove()
        .then(() => {
          alert('Equipo eliminado');
          cargarEquipos();
        })
        .catch((error) => {
          alert('Error al eliminar: ' + error.message);
        });
    }
  }
</script>
</body>  
</html>  
  